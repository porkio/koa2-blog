<%- include('layout/_header') %>
<link rel="stylesheet" href="../stylesheets/atom-one-light.css">
<script src="../scripts/highlight.pack.js"></script>
<script>
  hljs.initHighlightingOnLoad()

</script>
<section id="article">
  <div class="content">
    <div class="article-header">
      <div class="title">
        <a href="../"><i class="iconfont icon-home1"></i><%= article.title %></a>
      </div>
      <div class="progress" style="width: 12%"></div>
    </div>
    <div class="title-box">
      <h1><%= article.title %></h1>
      <div class="post-box">
        <div class="publish-time"><i class="iconfont icon-calendar"> <%= article.createdAt %></i></div>
        <div class="box-like"><i class="iconfont icon-heart"> <%= article.likes %></i></div>
        <div class="post-hots"><i class="iconfont icon-foot"> <%= article.views %></i></div>
      </div>
    </div>
    <div class="article-content">
      <!-- 文章内容开始 -->
      <%- article.content %>
      <!-- 文章内容结束 -->

      <!-- 点赞 -->
      <div class="give-like">
        <div class="btn-like">
          <i class="iconfont icon-zan1"></i>
          <span><%= article.likes %></span>
        </div>
      </div>

      <!-- 文章地址 转载信息 -->
      <div class="posmition">
        <p>文章版权所有：<a href="#" target="_blank">PORK's BLOG</a>，采用 <a
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用 4.0
            国际许可协议</a> 进行许可。</p>
        <p>欢迎分享，转载务必保留出处及原文链接 <a href="https://wlwo.net/articles/1.html"
            target="_blank">https://wlwo.net/articles/1.html</a></p>
      </div>

      <!-- 上一篇 下一篇文章 -->
      <div class="next-box">
        <p><a href="9.html"><i class="iconfont icon-handoleft"></i><span>JS异步加载、延时加载、按需加载</span></a></p>
        <p><a href="../articles/2.html"><span>真实的为我,便是最有益的为人</span><i class="iconfont icon-hand-o-right"></i></a>
        </p>
      </div>
    </div>

  </div>
</section>
<script type="module">
  import {
    utils
  } from "/scripts/utils.js";
  document.addEventListener('readystatechange', e => {
    if (document.readyState === 'complete') {
      // Document is ready...
      const articleId = '<%= article.id %>'
      let articleLikes = '<%= article.likes %>'
      console.log(articleId)
      const progress = document.querySelector('.progress')
      const titleLayer = document.querySelector('.article-header')
      const btnLike = document.querySelector('.btn-like')

      // 点赞
      btnLike.addEventListener('click', giveLike, false)


      document.addEventListener('scroll', e => {
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop
        if (scrollTop > 60) {
          if (!titleLayer.classList.contains('active')) {
            utils.toggleClassName(titleLayer, 'active')
          }
        } else {
          if (titleLayer.classList.contains('active')) {
            utils.toggleClassName(titleLayer, 'active')
          }
        }
        if (progress) {
          progress.style.width = (scrollTop / (document.body.clientHeight - document.documentElement
              .clientHeight) *
            100).toFixed(4) + '%'
        }
      }, false)

      function giveLike() {
        utils.ajax('/api/index/incArticleLikes', {
          method: 'POST',
          body: {
            id: articleId
          }
        }).then(res => {
          if (res.errno === 0) {
            btnLike.children[1].innerText = ++articleLikes
            btnLike.style.backgroundColor = '#eee'
            btnLike.style.color = '#a9aab1'
            btnLike.removeEventListener('click', giveLike, false)
          }
        })
      }




    }
  }, false)

</script>
<%- include('layout/_footer') %>
